<!DOCTYPE html>
<html>
<head>
    <title>Doctor's Day Mirror</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f0f8ff;
            padding: 20px;
        }
        #mirror {
            width: 500px;
            height: 400px;
            margin: 20px auto;
            border: 10px solid #0078d7;
            border-radius: 10px;
            background: #000;
            position: relative; /* This is crucial for positioning the logo inside */
        }
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        #quote {
            font-size: 18px;
            font-style: italic;
            margin: 20px auto;
            width: 500px;
            color: #333;
            padding: 15px;
            background: #fff;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            background: #0078d7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Here is someone truly special!<br>Look Closely..</h1>
    <div id="mirror">
        <img src="HCI_logo.png" alt="HCI Logo" style="position: absolute; top: 15px; right: 15px; width: 160px; height: 80px; z-index: 10;"> 
        <video id="video" autoplay></video>
    </div>
    <div id="quote">
        "To all the doctors who heal with compassion and careâ€”thank you for your dedication."
    </div>
    <button id="capture">Capture & Download</button>

    <script>
        const video = document.getElementById('video');
        const captureBtn = document.getElementById('capture');

        // Access the camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing camera: ", err);
                alert("Could not access the camera. Please enable permissions.");
            });

        captureBtn.addEventListener('click', () => {
            const mirror = document.getElementById('mirror');
            const quote = document.getElementById('quote');

            const canvas = document.createElement('canvas');
            canvas.width = mirror.offsetWidth;
            canvas.height = mirror.offsetHeight + quote.offsetHeight + 40;
            const ctx = canvas.getContext('2d');

            // Draw the video frame
            ctx.drawImage(video, 0, 0, mirror.offsetWidth, mirror.offsetHeight);

            // Load the logo dynamically
            const logoImage = new Image();
            // --- FIX 1: Add crossOrigin property to prevent canvas tainting ---
            logoImage.crossOrigin = "anonymous";
            logoImage.src = 'HCI_logo.png'; // Make sure this file exists in same folder

            logoImage.onload = () => {
                // Draw the logo at top right of the canvas
                const logoWidth = 160;
                const logoHeight = 80;
                ctx.drawImage(
                    logoImage,
                    canvas.width - logoWidth - 15,
                    15,
                    logoWidth,
                    logoHeight
                );

                // Draw the white background for the quote
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, mirror.offsetHeight, canvas.width, quote.offsetHeight + 40);

                // Draw the quote text
                ctx.fillStyle = '#333333';
                ctx.font = 'italic 18px Arial';
                ctx.textAlign = 'center';
                const maxLineWidth = mirror.offsetWidth - 40;
                const words = quote.textContent.split(' ');
                let line = '';
                let yPos = mirror.offsetHeight + 40;
                for (let i = 0; i < words.length; i++) {
                    const testLine = line + words[i] + ' ';
                    const metrics = ctx.measureText(testLine);
                    if (metrics.width > maxLineWidth && i > 0) {
                        ctx.fillText(line, canvas.width / 2, yPos);
                        yPos += 25;
                        line = words[i] + ' ';
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line, canvas.width / 2, yPos);

                // --- FIX 2: Add try-catch for error handling and use correct MIME type ---
                try {
                    // Auto-download the image
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL('i '); // Use correct MIME type
                    link.download = 'doctors-day-thank-you.png';
                    link.click();
                } catch (e) {
                    console.error("Canvas toDataURL error:", e);
                    alert("Capture Failed: Could not save the image due to browser security restrictions.\n\nSOLUTION: Please run this page using a local web server.");
                }
            };

            logoImage.onerror = () => {
                alert('Logo image could not be loaded. Make sure HCI_logo.png is in the same folder.');
            };
        });
    </script>
</body>
</html>